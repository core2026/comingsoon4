<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cedar Radar</title>
    <style>
        body { background: #f8fafc; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; font-family: sans-serif; }
        .card { width: 90%; max-width: 380px; background: white; border-radius: 24px; padding: 30px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); text-align: center; border: 1px solid #e2e8f0; }
        .badge { padding: 15px; border-radius: 12px; font-weight: 800; margin: 20px 0; text-transform: uppercase; }
        #debug-info { font-size: 0.6rem; color: #cbd5e1; margin-top: 10px; word-break: break-all; }
    </style>
</head>
<body>

<div class="card">
    <h2 id="title">Pollen Radar</h2>
    <div class="badge" id="meter" style="background: #f1f5f9;">Connecting...</div>
    <div style="height:200px"><canvas id="pollenChart"></canvas></div>
    <div id="debug-info">Checking connection...</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // We remove the trailing slash and add a cache-buster
    const WORKER_URL = 'https://pollen-proxy.acekallas.workers.dev'; 

    async function fetchData() {
        const meter = document.getElementById('meter');
        const debug = document.getElementById('debug-info');
        
        try {
            // The "Hammer" Fetch: added 'cors' mode and specific headers
            const res = await fetch(`${WORKER_URL}?lat=29.70&lon=-98.63&t=${Date.now()}`, {
                method: 'GET',
                mode: 'cors', 
                headers: {
                    'Accept': 'application/json'
                }
            });

            if (!res.ok) throw new Error(`Server returned ${res.status}`);

            const result = await res.json();
            const info = result.data[0];
            
            debug.innerText = "Connection Successful";
            updateUI(info.Risk.tree_pollen, info.Species.Tree["Cypress / Juniper / Cedar"]);
        } catch (e) {
            console.error(e);
            meter.innerText = "Connection Failed";
            debug.innerText = "Error: " + e.message + " | Check browser console (F12)";
        }
    }

    function updateUI(risk, cedarCount) {
        const meter = document.getElementById('meter');
        meter.innerText = `${risk} Risk (${cedarCount} Cedar)`;
        meter.style.background = risk === "High" ? "#ef4444" : "#10b981";
        // ... (Chart code omitted for brevity, but keep yours)
    }

    window.onload = fetchData;
</script>
</body>
</html>
