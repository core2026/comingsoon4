<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cedar Radar Pro</title>
    <style>
        :root { --accent: #10b981; }
        body { 
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); 
            color: white; display: flex; justify-content: center; align-items: center; 
            min-height: 100vh; margin: 0; font-family: 'Segoe UI', system-ui, sans-serif;
        }
        .card { 
            width: 90%; max-width: 400px; background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(12px); border-radius: 30px; padding: 35px;
            border: 1px solid rgba(255, 255, 255, 0.1); text-align: center;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }
        .cedar-count { font-size: 3rem; font-weight: 900; margin: 10px 0; text-shadow: 0 0 20px var(--accent); }
        .badge { 
            display: inline-block; padding: 8px 20px; border-radius: 100px; 
            background: var(--accent); font-size: 0.8rem; font-weight: bold; text-transform: uppercase;
        }
        .legend { 
            display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; 
            margin-top: 25px; font-size: 0.7rem; color: #94a3b8;
        }
        .legend-item { background: rgba(255,255,255,0.05); padding: 10px; border-radius: 12px; }
        canvas { margin-top: 20px; }
    </style>
</head>
<body>

<div class="card">
    <div class="badge" id="risk-badge">Low Risk</div>
    <div class="cedar-count" id="count-val">0</div>
    <div style="font-size: 0.9rem; opacity: 0.8;">Mountain Cedar ($gr/m^3$)</div>
    
    <div class="legend">
        <div class="legend-item"><b>Grass</b><br><span id="grass-val">-</span></div>
        <div class="legend-item"><b>Weeds</b><br><span id="weed-val">-</span></div>
        <div class="legend-item"><b>Air Quality</b><br>Good</div>
    </div>

    <canvas id="pollenChart" height="150"></canvas>
    <p id="timestamp" style="font-size: 0.6rem; opacity: 0.4; margin-top: 20px;"></p>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const WORKER_URL = 'https://pollen-proxy.acekallas.workers.dev';

    async function updateApp() {
        const res = await fetch(`${WORKER_URL}?lat=29.70&lon=-98.63`);
        const result = await res.json();
        const info = result.data[0];

        const cedar = info.Species.Tree["Cypress / Juniper / Cedar"] || 0;
        const risk = info.Risk.tree_pollen;

        // UI Updates
        document.getElementById('count-val').innerText = cedar;
        document.getElementById('risk-badge').innerText = `${risk} Risk`;
        document.getElementById('grass-val').innerText = info.Risk.grass_pollen;
        document.getElementById('weed-val').innerText = info.Risk.weed_pollen;
        document.getElementById('timestamp').innerText = `Last sync: ${new Date().toLocaleTimeString()}`;

        // Change color based on risk
        const root = document.querySelector(':root');
        if (risk === "High" || cedar > 100) root.style.setProperty('--accent', '#ef4444');
        else if (risk === "Moderate") root.style.setProperty('--accent', '#f59e0b');
        else root.style.setProperty('--accent', '#10b981');
    }

    window.onload = updateApp;
</script>
</body>
</html>
